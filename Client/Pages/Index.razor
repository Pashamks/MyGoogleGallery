@page "/"
@using System.Globalization
@using Radzen
@inject HttpClient Http
@using System.Text.Json
<style>
    body {
        background-image: url('https://images.pexels.com/photos/924824/pexels-photo-924824.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
        background-size: 100% 100%;
    }
    .main-text {
        color: white;
        text-align: center;
        margin-bottom: 2%;
    }
    

</style>
<h1 class="main-text">Welcome to MyGoogle Gallery!</h1>

<div class="row col-12">
    <div class="col col-6">
        <h2 class="main-text">The most popular photos:</h2>
        <div class="row">
            <div>
                <img src="@PopularImages[0]"/>
            </div>
            <div>
                <img src="@PopularImages[1]"/>
            </div>
        </div>
        <div class="row">
            <div>
                <img src="@PopularImages[2]"/>
            </div>
            <div>
                <img src="@PopularImages[3]"/>
            </div>
        </div>
    </div>
    <div class="col-6">
        <h2 class="main-text">Photos statistic:</h2>
        <div class="container">
            <div class="row">
                <div >
                    <RadzenChart Style="color: white;">
                        <RadzenPieSeries Data="@revenue" Title="Revenue" CategoryProperty="PhotoName" ValueProperty="SearchingAmount" />
                    </RadzenChart>
                </div>
            </div>
        </div>
    </div>
    
</div>


@code{
    List<string> PopularImages = new List<string> { "","","","" };
    List<DataItem> revenue;
    protected async Task GetChartData()
    {
        var res = await Http.GetAsync($"https://localhost:5001/api/UserPhoto/get_chart_data");
        var mydictionary = JsonSerializer.Deserialize<Dictionary<string, int>>(res.Content.ReadAsStringAsync().Result);
        revenue = mydictionary.Select(x => new DataItem { PhotoName = x.Key, SearchingAmount = x.Value}).ToList();
    }

    protected override async Task OnInitializedAsync()
    {
        await GetChartData();
        await GetPopilarImages();
    }
    protected async Task GetPopilarImages()
    {
        var res = await Http.GetAsync($"https://localhost:5001/api/UserPhoto/get_photos");
        Console.WriteLine(res.Content.ReadAsStringAsync().Result);
        var mylist = JsonSerializer.Deserialize<List<MyUserPhoto>>(res.Content.ReadAsStringAsync().Result);

        mylist.Sort((x,y) => y.searchingCounter-x.searchingCounter);

        foreach (var item in mylist)
        {
            Console.WriteLine(item.photoType);
        }
        PopularImages = mylist.Select(x=>x.photoUrl).ToList();
    }

    class DataItem
    {
        public string PhotoName { get; set; }
        public int SearchingAmount { get; set; }
    }

    class MyUserPhoto
    {
        public string photoUrl { get; set; }
        public string photoType { get; set; }
        public int searchingCounter { get; set; }
    }

}

